{"version":3,"sources":["app/core.cljs"],"mappings":"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","names":["app.core/controls-scheme","app.core/listen-touch","el","press","cb","G__26132","G__26133","G__26134","goog.events/listen","goog.events/EventType.TOUCHSTART","goog.events/EventType.TOUCHEND","evt","G__26135","G__26136","G__26137","goog.events/EventType.MOUSEDOWN","goog.events/EventType.MOUSEUP","app.core/setup-keys","ci","controls","seq__26138","cljs.core/seq","chunk__26139","count__26140","i__26141","temp__5735__auto__","cljs.core/chunked-seq?","c__4609__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/count","cljs.core/first","cljs.core/next","c","map__26146","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","map__26148","id","code","goog.dom/getElement","app.core/fullscreen","goog.dom.fullscreen/requestFullScreen","app.core/listen-fullscreen","btn","app.core/process-ci","app.core/on-ready","fs","main","p1","p2","G__26150","app.core/launch","runner","js/Dos","app.core/main!"],"sourcesContent":["(ns app.core\n  (:require\n   [\"js-dos\"]\n   [goog.dom :as dom]\n   [goog.dom.fullscreen :refer [requestFullScreen]]\n   [goog.events :as events]))\n\n(def controls-scheme\n  [{:id \"left\"\n    :code 37}\n\n   {:id \"right\"\n    :code 39}\n\n   {:id \"up\"\n    :code 38}\n\n   {:id \"down\"\n    :code 40}\n\n   {:id \"space\"\n    :code 32}\n\n   {:id \"enter\"\n    :code 13}])\n\n(defn listen-touch [el press cb]\n  (events/listen\n    el\n    (if press\n      events/EventType.TOUCHSTART\n      events/EventType.TOUCHEND)\n    (fn [evt]\n      (.preventDefault evt)\n      (cb)))\n  (events/listen\n    el\n    (if press\n      events/EventType.MOUSEDOWN\n      events/EventType.MOUSEUP)\n    (fn [evt]\n      (.preventDefault evt)\n      (cb))))\n\n(defn setup-keys [ci controls]\n  (doseq [c controls]\n    (let [{:keys [id code]} c\n          el (dom/getElement id)]\n      (listen-touch\n       el\n       true\n       #(.simulateKeyEvent ci code true))\n      (listen-touch\n       el\n       false\n       #(.simulateKeyEvent ci code false)))))\n\n(defn fullscreen []\n  (let [el (dom/getElement \"player-container\")]\n    (requestFullScreen el)))\n\n(defn listen-fullscreen []\n  (let [btn (dom/getElement \"fullscreen\")]\n    (listen-touch btn true fullscreen)))\n\n(defn process-ci [ci]\n  (setup-keys ci controls-scheme))\n\n(defn on-ready [fs, main]\n  (let [p1 (.extract fs \"chip.zip\")\n        p2 (.then p1 #(main #js [\"-c\" \"CHIPS.EXE\"]))]\n    (.then p2 process-ci)\n    (listen-fullscreen)))\n\n(defn launch []\n  (let [el (dom/getElement \"playerbox\")\n        runner (js/Dos el)]\n    (.ready runner on-ready)))\n\n(defn main! []\n  (launch))\n"]}