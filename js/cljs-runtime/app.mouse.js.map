{"version":3,"sources":["app/mouse.cljs"],"mappings":";;;;AAKA,AAAA,AAAKA;AAEL,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAKC;AAKL,AAAA,AAAMC,AAAKC;AAAX,AAAc,AAAA,AAAgBA;;AAE9B,AAAKC,AAAO,AAAA,AAACC;AAEb,AAAA,AAAMC,AAAYC,AAAGC;AAArB,AACE,AAAI,AAAA,AAAMA;AACR,AAAU,AAAA,AAAAC,AAAA,AAAOL;AAAjB;;AAAA,AACE,AAAmBG,AAAG,AAAAG,AAAA,AAAAD,AAAQL;AAAR,AAAA,AAAAM,AAAAA,AAACT,AAAAA,AAAAA;AAAvB;;AACA,AAAA,AAACU,AAAOP;;;AACV,AAAU,AAAA,AAAAK,AAACG,AAAGR,AAAOI;AAArB;;AAAA,AACE,AAAU,AAAA,AAAAC,AAAA,AAAOL;AAAjB;AAAA,AAAyB,AAAmBG,AAAG,AAAAM,AAAA,AAAAJ,AAAQL;AAAR,AAAA,AAAAS,AAAAA,AAACZ,AAAAA,AAAAA;AAAvB;;;AACzB,AAACU,AAAOP,AAAOI;;AACf,AAAmBD,AAAG,AAAAO,AAAA,AAAAL,AAAQL;AAAR,AAAA,AAAAU,AAAAA,AAACb,AAAAA,AAAAA;AAAvB;;;;AAEN,AAAA,AAAMc,AAAaR;AAAnB,AACE,AAAMU,AAAG,AAAA,AAACC;AACJC,AAAU,AAAA,AAACd;AACXe,AAAO,AAAA,AAACf;AACRgB,AAAQ,AAAKC;AAAL,AACE,AAAMC,AAAO,AAACC,AAAMC,AAAE,AAAA,AAAAC,AAACC;AAAD,AAAM,AAAAD;AAAN,AAAA,AAAAjB,AAAsBU,AAAUG;AAChDM,AAAO,AAACJ,AAAMC,AAAE,AAAA,AAAAI,AAACF;AAAD,AAAM,AAAAE;AAAN,AAAA,AAAApB,AAAsBU,AAAUG;AAChDQ,AAAK,AAACC,AAAYR;AAClBS,AAAK,AAACD,AAAYH;AAClBK,AAAE,AAACC,AAAa,AAAG,AAAChC,AAAIqB,AAAQ,AAACrB,AAAI0B;AACrCpB,AAAO,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AACC,AAAGyB,AAAEjC,AACL,AAAK,AAAA,AAAM4B,AAAQ,AAAGI,AAAKF,AAC3B,AAAK,AAAA,AAAMF,AAAQ,AAAGI,AAAKF,AAC3B,AAAK,AAAA,AAAMP,AAAQ,AAAGO,AAAKE,AAC3B,AAAK,AAAA,AAAMT,AAAQ,AAAGO,AAAKE;AAVzC,AAWI,AAAC1B,AAAWC,AAAGC;;AAfnC,AAAAQ,AAgBMmB;AAhBN,AAgBgB,AAAAnB,AAACL,AAAOQ;;AAhBxB,AAiBMiB;AAjBN,AAiBkB,AAAA,AAAC9B,AAAWC;;AAjB9B,AAkBE,AAAC8B,AAAcpB,AAAGqB,AAA4BH;;AAC9C,AAACE,AAAcpB,AAAGsB,AAA2BlB;;AAC7C,AAACgB,AAAcpB,AAAGuB,AAA0BJ","names":["app.mouse/THRESHOLD","app.mouse/CODES","app.mouse/sqr","x","app.mouse/motion","cljs.core.atom.cljs$core$IFn$_invoke$arity$1","app.mouse/control-ci","ci","action","cljs.core/deref","G__27010","cljs.core/reset!","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","G__27011","G__27012","app.mouse/setup-mouse","p1__27015#","el","goog.dom/getElement","start-evt","motion","on-move","move-evt","deltaX","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/-","p1__27013#","cljs.core.map.cljs$core$IFn$_invoke$arity$2","deltaY","p1__27014#","absX","js/Math.abs","absY","r","js/Math.sqrt","on-start","on-release","goog.events/listen","goog.events/EventType.TOUCHSTART","goog.events/EventType.TOUCHMOVE","goog.events/EventType.TOUCHEND"],"sourcesContent":["(ns app.mouse\n  (:require\n   [goog.dom :as dom]\n   [goog.events :as events]))\n\n(def THRESHOLD 10)\n\n(def CODES {:up 38\n            :down 40\n            :left 37\n            :right 39})\n\n(defn sqr [x] (bit-shift-left x 1))\n\n(def motion (atom nil))\n\n(defn control-ci [ci action]\n  (if (nil? action)\n    (when-not (nil? @motion)\n      (.simulateKeyEvent ci (CODES @motion) false)\n      (reset! motion nil))\n    (when-not (= @motion action)\n      (when-not (nil? @motion) (.simulateKeyEvent ci (CODES @motion) false))\n      (reset! motion action)\n      (.simulateKeyEvent ci (CODES @motion) true))))\n\n(defn setup-mouse [ci]\n  (let [el (dom/getElement \"container\")\n        start-evt (atom nil)\n        motion (atom nil)\n        on-move (fn [move-evt]\n                  (let [deltaX (apply - (map #(.-clientX %) [@start-evt move-evt]))\n                        deltaY (apply - (map #(.-clientY %) [@start-evt move-evt]))\n                        absX (js/Math.abs deltaX)\n                        absY (js/Math.abs deltaY)\n                        r (js/Math.sqrt (+ (sqr deltaX) (sqr deltaY)))\n                        action (cond\n                                (< r THRESHOLD) nil\n                                (and (neg? deltaY) (> absY absX)) :down\n                                (and (pos? deltaY) (> absY absX)) :up\n                                (and (neg? deltaX) (> absX absY)) :right\n                                (and (pos? deltaX) (> absX absY)) :left)]\n                      (control-ci ci action)))\n        on-start #(reset! start-evt %)\n        on-release #(control-ci ci nil)]\n    (events/listen el events/EventType.TOUCHSTART on-start)\n    (events/listen el events/EventType.TOUCHMOVE on-move)\n    (events/listen el events/EventType.TOUCHEND on-release)))\n"]}